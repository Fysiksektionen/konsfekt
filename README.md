## Develop
Dependencies:
- rust
- npm

### Setup
Get Google OAuth client credentials from [Google](https://console.developers.google.com/). You will need a client id and a client secret.
Make sure to add `http://127.0.0.1:8080` as an Authorized JavaScript origin and `http://127.0.0.1:8080/api/auth/google/callback`
as an Authorized redirect URI.

> Due to a limited set of authorized origins Google allows, simple developing is limited to `localhost` 
unless using a tunneling service.

Create a `.env` from the `template.env` file with the following fields filled in
- `GOOGLE_CLIENT_ID`
- `GOOGLE_CLIENT_SECRET`

### Frontend
The following commands need to be run inside the `frontend` directory.
- `npm install`, install all frontend dependencies (required)
- `npm run dev`, serve frontend on `127.0.0.1:5173` with a live preview on code changes
- `npm run build`, build frontend (only needed for static frontend)

### Backend
The following commands need to be run inside the root directory.
- `cargo run`, run backend in debug mode (non-static frontend)
- `cargo run --release`, run backend in production mode (static frontend)

> NOTE: Middleware will not be applied to frontend routes (/) when serving the frontend separately. This means that some redirects and permission checks won't work.

> If you need a valid session to do something, please go to `/login` manually and log in. 

> E.g `/admin` will be accessible with a normal account.


## Docker
Dependencies:
- docker (docker compose)

Set a value to the following environment variables:
- `SITE_DOMAIN` where the webapp should be accessible at
- `DATABASE_DIR` location to store database and uploaded images
- `PERMISSION_TABLE_PATH` file path to role permissions

Run the container with `docker compose up --build` (`--build` flag only needed the first time)

## About

### Environment variables
- `STATIC_FRONTEND` tells the backend to serve a prebuilt frontend, only has effect in debug mode.

### Backend
This project uses a Rust backend built with [Actix Web](https://actix.rs).

### Frontend
The frontend is served as a static site generated by [SvelteKit](https://svelte.dev).
[shadcn-svelte](https://www.shadcn-svelte.com/docs/components) is used for predefined components.

### Auth
Session handling is done using principles from [lucia-auth](https://lucia-auth.com) with login done through Google.
